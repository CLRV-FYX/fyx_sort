name: FYX-SORT CI

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
        compiler: [g++, clang++]
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Setup compiler
      run: |
        if [ "${{ matrix.compiler }}" = "clang++" ] && [ "${{ matrix.os }}" = "ubuntu-latest" ]; then
          sudo apt-get update
          sudo apt-get install -y clang
        fi
    
    - name: Build and test
      run: |
        # 创建测试程序
        cat > test.cpp << 'EOF'
#define FYX_MAIN
#include "fyx_sort.hpp"
int main() { return main_test(); }
EOF
        
        # 编译
        ${{ matrix.compiler }} -std=c++17 -O2 -pthread -o test test.cpp
        
        # 运行测试
        ./test
